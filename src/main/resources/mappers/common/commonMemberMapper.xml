<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.sist.common.member.CommonMemberMapper">

    <!-- 사용자 아이디 찾기 (전화번호) -->
    <select id="selectUserByPhone" parameterType="String" resultType="String">
        SELECT USER_ID FROM USERS WHERE PHONE = #{phone}
    </select>

    <!-- 강사 아이디 찾기 (전화번호) -->
    <select id="selectInstructorByPhone" parameterType="String" resultType="String">
        SELECT INST_ID FROM INSTRUCTOR WHERE PHONE = #{phone}
    </select>

    <!-- 사용자 이메일 정보 확인 (비밀번호 찾기) -->
    <select id="selectUserEmailByInfo" parameterType="java.util.Map" resultType="String">
        SELECT EMAIL FROM USERS WHERE USER_ID = #{id} AND NAME = #{name}
    </select>

    <!-- 강사 이메일 정보 확인 (비밀번호 찾기) -->
    <select id="selectInstructorEmailByInfo" parameterType="java.util.Map" resultType="String">
        SELECT EMAIL FROM INSTRUCTOR WHERE INST_ID = #{id} AND NAME = #{name}
    </select>
    
    <!-- 사용자 비밀번호 조회 (재사용 방지용) -->
    <select id="selectUserPassword" parameterType="String" resultType="String">
        SELECT PASSWORD FROM USERS WHERE USER_ID = #{id}
    </select>

    <!-- 강사 비밀번호 조회 (재사용 방지용) -->
    <select id="selectInstructorPassword" parameterType="String" resultType="String">
        SELECT PASSWORD FROM INSTRUCTOR WHERE INST_ID = #{id}
    </select>

    <!-- 발송 이력 저장 -->
    <insert id="insertTransmissionHistory" parameterType="java.util.Map">
        INSERT INTO TRANSMISSION_HISTORY (TRANS_ID, PHONE, EMAIL, TRANSDATE)
        VALUES (SEQ_TRANS_ID.NEXTVAL, #{phone}, #{email, jdbcType=VARCHAR}, SYSDATE)
    </insert>

    <!-- 사용자 비밀번호 변경 -->
    <update id="updateUserPassword" parameterType="java.util.Map">
        UPDATE USERS SET PASSWORD = #{password} WHERE USER_ID = #{id}
    </update>

    <!-- 강사 비밀번호 변경 -->
    <update id="updateInstructorPassword" parameterType="java.util.Map">
        UPDATE INSTRUCTOR SET PASSWORD = #{password} WHERE INST_ID = #{id}
    </update>

</mapper>
