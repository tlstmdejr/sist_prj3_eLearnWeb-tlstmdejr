package kr.co.sist.user.member;

import org.apache.ibatis.exceptions.PersistenceException;
import org.apache.ibatis.session.SqlSession;
import org.springframework.stereotype.Repository;

/**
 * 학생 회원 관련 DB 접근을 담당하는 DAO 클래스
 * - MyBatis를 사용하여 학생 테이블(user)에 CRUD 수행
 */
@Repository
public class UserDAO {

    /**
     * 학생 한 명 검색 (상세정보 조회)
     * @param stuId 학생 아이디
     * @return StudentDomain 학생 정보
     * @throws PersistenceException DB 예외
     */
    public UserDomain selectOneStu(String stuId) throws PersistenceException {
        UserDomain sd = null;
        
        SqlSession ss = MyBatisHandler.getInstance().getMyBatisHandler(false);
        // TODO: mapper 호출
        // sd = ss.selectOne("kr.co.sist.user.member.selectOneStu", stuId);
        if (ss != null) { ss.close(); }
        
        return sd;
    }

    /**
     * 아이디 중복체크
     * @param userId 확인할 아이디
     * @return String 존재하면 아이디, 없으면 null
     * @throws PersistenceException DB 예외
     */
    public String selectChkId(String userId) throws PersistenceException {
        String result = null;
        
        SqlSession ss = MyBatisHandler.getInstance().getMyBatisHandler(false);
        // TODO: mapper 호출
        // result = ss.selectOne("kr.co.sist.user.member.selectChkId", userId);
        if (ss != null) { ss.close(); }
        
        return result;
    }

    // /**
    //  * 학생 로그인 (아이디, 비밀번호로 사용자 조회)
    //  * @param stuId 학생 아이디
    //  * @param stuPass 학생 비밀번호
    //  * @return StudentDomain 로그인한 학생 정보
    //  * @throws PersistenceException DB 예외
    //  */
    // public StudentDomain selectLogin(String stuId, String stuPass) throws PersistenceException {
    //     StudentDomain sd = null;
        
    //     SqlSession ss = MyBatisHandler.getInstance().getMyBatisHandler(false);
    //     // TODO: mapper 호출 (parameterType을 Map이나 DTO로 변경 필요)
    //     // sd = ss.selectOne("kr.co.sist.user.member.selectLogin", param);
    //     if (ss != null) { ss.close(); }
        
    //     return sd;
    // }

   
//.common으로 이동시켜서 공통으로 사용할예정
    // /**
    //  * 아이디 찾기 (전화번호로 조회)
    //  * @param stuPhone 학생 전화번호
    //  * @return String 찾은 아이디
    //  * @throws PersistenceException DB 예외
    //  */
    // public String selectId(String stuPhone) throws PersistenceException {
    //     String userId = null;
        
    //     SqlSession ss = MyBatisHandler.getInstance().getMyBatisHandler(false);
    //     // TODO: mapper 호출
    //     // userId = ss.selectOne("kr.co.sist.user.member.selectId", stuPhone);
    //     if (ss != null) { ss.close(); }
        
    //     return userId;
    // }

    // /**
    //  * 비밀번호 찾기
    //  * @param sDTO 학생 정보 (아이디, 전화번호, 이메일)
    //  * @return String 찾은 비밀번호
    //  * @throws PersistenceException DB 예외
    //  */
    // public String selectPass(StudentDTO sDTO) throws PersistenceException {
    //     String userPass = null;
        
    //     SqlSession ss = MyBatisHandler.getInstance().getMyBatisHandler(false);
    //     // TODO: mapper 호출
    //     // userPass = ss.selectOne("kr.co.sist.user.member.selectPass", sDTO);
    //     if (ss != null) { ss.close(); }
        
    //     return userPass;
    // }

    /**
     * 학생 회원가입
     * @param sDTO 가입할 학생 정보
     * @return int 입력된 행 수 (1: 성공, 0: 실패)
     * @throws PersistenceException DB 예외
     */
    public int insertStu(UserDTO sDTO) throws PersistenceException {
        int result = 0;
        
        SqlSession ss = MyBatisHandler.getInstance().getMyBatisHandler(true);
        // TODO: mapper 호출
        // result = ss.insert("kr.co.sist.user.member.insertStu", sDTO);
        if (ss != null) { ss.close(); }
        
        return result;
    }

    /**
     * 학생 정보 수정
     * @param sDTO 수정할 학생 정보
     * @return int 수정된 행 수 (1: 성공, 0: 실패)
     * @throws PersistenceException DB 예외
     */
    public int updateStu(UserDTO sDTO) throws PersistenceException {
        int result = 0;
        
        SqlSession ss = MyBatisHandler.getInstance().getMyBatisHandler(true);
        // TODO: mapper 호출
        // result = ss.update("kr.co.sist.user.member.updateStu", sDTO);
        if (ss != null) { ss.close(); }
        
        return result;
    }

    /**
     * 학생 회원 탈퇴
     * @param userId 학생 아이디
     * @param userPass 학생 비밀번호
     * @return int 삭제된 행 수 (1: 성공, 0: 실패)
     * @throws PersistenceException DB 예외
     */
    public int deleteStu(String userId, String userPass) throws PersistenceException {
        int result = 0;
        
        SqlSession ss = MyBatisHandler.getInstance().getMyBatisHandler(true);
        // TODO: mapper 호출 (실제 삭제 또는 activation='N'으로 업데이트)
        // result = ss.delete("kr.co.sist.user.member.deleteStu", param);
        if (ss != null) { ss.close(); }
        
        return result;
    }
}
// class
