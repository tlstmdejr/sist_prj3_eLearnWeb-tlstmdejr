# 관리자 회원관리(회원/강사) 페이지네이션 적용 및 기능 변경 내역

## 1. 변경 목표 (한 줄 요약)

`/admin/member/userList`와 `/admin/member/instructorList` 페이지에서  
회원/강사 목록을 한 번에 모두 불러오지 않고 **페이지 단위(예: 10개씩)**로 나누어 보여주도록 개선했다.  
이 과정에서 DB 조회 쿼리, 서비스 로직, 컨트롤러, 화면 뷰를 함께 수정했다.

---

## 2. 왜 이 작업이 필요했나

처음 구조는 회원/강사 전체 리스트를 한 번에 가져오는 방식이었다.  
데이터가 많아지면 문제가 커지는 이유는 다음과 같다.

1) 화면 진입 시 DB에서 모든 행을 읽어옴  
2) 브라우저가 전부 렌더링해야 함  
3) 조회가 느려지고, 페이지 응답이 지연됨  
4) 관리자가 페이지를 열 때마다 리소스가 불필요하게 많이 소모됨

페이지네이션을 적용하면 `1~10`, `11~20`처럼 필요한 구간만 조회하므로  
응답 속도와 안정성이 개선된다.

---

## 3. 실제 변경 파일과 역할

## 3.1 `src/main/resources/mappers/admin/adminMemberMapper.xml`

이 파일은 DB 쿼리의 핵심이다.

### 변경한 쿼리 항목

#### 1) 사용자 목록 페이지네이션 조회
- `selectUserListByPage`
- 파라미터: `startRow`, `endRow`
- 동작:
  - 내부 서브쿼리에서 `ROW_NUMBER() OVER (ORDER BY REGDATE DESC)`로 행 번호를 매김
  - 외부에서 `rnum`이 `startRow ~ endRow` 사이인 데이터만 조회
- 효과:
  - 매 요청마다 1페이지/2페이지처럼 원하는 범위만 DB에서 가져옴

#### 2) 강사 목록 페이지네이션 조회
- `selectInstructorListByPage`
- 사용자 목록과 동일한 방식 사용
- 강사 전용 테이블 `INSTRUCTOR` 기준으로 조회

#### 3) 전체 건수 조회
- `selectUserCount`
- `selectInstructorCount`
- 화면에서 총 페이지 수를 계산하기 위해 필요한 값

#### 4) 기존 단일 조회 유지
- `selectUser`, `selectInstructor`는 상세 모달/개별 조회에 그대로 사용

### 별칭(alias) 정리

예전에는 서브쿼리 별칭이 `a`로 있었는데, 현재는 가독성 향상을 위해 바뀌었다.

- 사용자 쿼리: `a` → `u`
- 강사 쿼리: `a` → `i`

즉, `u.id`, `i.instId`처럼 읽기 쉬운 형태로 바뀌었다.

### DB 예약어 대응(중요)

`PROFILE`은 Oracle에서 예약어로 오인될 수 있어 `"PROFILE"`로 감싸는 방식도 적용되어 있다.  
이 부분은 `ORA-00904` 에러 방지를 위한 안전 장치에 해당한다.

---

## 3.2 `src/main/java/kr/co/sist/admin/member/AdminMemberService.java`

서비스 레이어는 “요청 받은 페이지 번호를 실제 조회 범위로 바꾸는 계산기 + 오류 방어” 역할을 한다.

### `getUserList(int page, int size)`
- 시작 행(`startRow`) 계산: `(page - 1) * size + 1`
- 끝 행(`endRow`) 계산: `page * size`
- 실제 DB 조회는 `selectUserListByPage(startRow, endRow)`로 수행
- 암호화된 이름/이메일 복호화 처리: `cryptoUtil.decryptSafe(...)`
- 예외가 나면 빈 리스트를 반환해서 화면이 깨지지 않도록 처리

### `getInstructorList(int page, int size)`
- 사용자 리스트와 동일한 패턴으로 강사도 페이지네이션 적용

### `getUserTotalCount`, `getInstructorTotalCount`
- 전체 건수를 조회해서 `총 페이지 수` 계산에 사용

---

## 3.3 `src/main/java/kr/co/sist/admin/member/AdminMemberController.java`

컨트롤러는 화면 요청의 입력값을 정리해 뷰로 전달한다.

### `GET /admin/member/userList`
- 요청 파라미터:
  - `page` (기본 1)
  - `size` (기본 10)
- 유효성:
  - page가 1보다 작으면 1로 보정
  - size가 1 미만이면 기본값 10, 100 초과면 100으로 제한
- 계산:
  - 전체 건수 조회
  - 총 페이지 수 계산
  - 현재 블록(예: 1~10, 11~20) 계산
- 뷰에 전달되는 값:
  - `userList`, `currentPage`, `pageSize`, `totalCount`, `totalPages`, `startPage`, `endPage`

### `GET /admin/member/instructorList`
- 회원 목록과 동일한 로직을 강사용으로 적용

### 상세 조회 AJAX 엔드포인트
- `/admin/member/userDetail`
- `/admin/member/instructorDetail`
- 모달에서 클릭한 항목의 상세정보 조회용으로 사용

---

## 3.4 `src/main/resources/templates/admin/member/userList.html`

화면에서 실제로 사용자에게 보이는 부분이다.

### 표시 방식
- 사용자 목록 테이블 렌더링
- `th:each="user : ${userList}"`로 행 반복
- `user.activation` 값에 따라 상태 라벨 표시
- 빈 목록일 때 “목록이 없습니다” 메시지 출력

### 페이지네이션 UI
- 이전/다음 버튼
- 현재 페이지 강조 표시
- 선택 가능한 페이지 번호 렌더링
- `size`(한 번에 몇 개씩) 포함 링크로 페이지 이동시 현재 설정 유지

### 모달 상세조회
- 클릭 시 `/admin/member/userDetail` 호출
- id/name/email/intro/activation/profile 정보를 모달에 세팅

---

## 3.5 `src/main/resources/templates/admin/member/instructorList.html`

강사 목록 화면도 동일한 페이지네이션 패턴으로 구성됨.

### 표시 방식
- 강사 리스트 행 반복 및 상태 표시(승인/미승인)
- 체크박스 및 승인 버튼 동작 구조 유지

### 페이지네이션 UI
- 사용자 목록과 동일한 형태로 `instructorList(page, size)` 이동

### 모달 상세조회
- `/admin/member/instructorDetail` 호출
- 승인 상태 반영 및 승인 버튼 상태 제어

---

## 4. 요청에서 응답으로 가는 데이터 흐름 (비전공자 설명)

1. 관리자가 `/admin/member/userList` 접속
2. 브라우저는 `page=1, size=10`을 보냄
3. 컨트롤러가 페이지 범위를 계산(`startRow=1`, `endRow=10`)
4. 서비스가 “요청한 범위만” DB에 조회 요청
5. Mapper가 `rnum BETWEEN 1 AND 10`로 10개만 가져옴
6. 화면에 10개 행과 페이지 버튼 표시
7. 다음 버튼 클릭 시 `page=2`로 동일한 방식 재조회

즉, 항상 필요한 만큼만 DB에서 받아 화면이 더 가볍고 반응이 빨라진다.

---

## 5. 해결한/주목할 점

### 문제의 핵심
초기 에러 로그에 `ORA-00904: "PROFILE": invalid identifier`가 있었음.  
이는 DB가 `PROFILE`을 컬럼으로 인식하지 못했거나 예약어로 다뤄지며 발생 가능성이 큼.

### 대응
- `"PROFILE"` 형태로 따옴표 처리
- 실행 SQL의 최신 반영 여부를 서버 재시작/재빌드로 확인 필요
- 빌드 산출물(`target/classes`) 최신화 필요

---

## 6. 사용자가 체감할 기능 변화

1. 목록 조회 속도 개선 (한 번에 가져오는 행 수 감소)
2. 페이지 이동만으로 끊김 없는 탐색 가능
3. 페이지 이동 시 UI가 즉시 현재 위치를 보여줌
4. 전체 목록 기반에서 페이지 기반 데이터 처리로 안정성 확보

---

## 7. 테스트 시나리오

## 7.1 기본 동작
1. `/admin/member/userList` 접속
2. 리스트가 10개 기준으로 보이는지 확인
3. `다음` 클릭 시 2페이지 데이터로 이동하는지 확인
4. `이전` 클릭 시 1페이지 복귀

## 7.2 강사 목록
1. `/admin/member/instructorList` 접속
2. 강사 리스트와 페이지 버튼 표시 확인
3. 강사행 클릭으로 상세 모달 조회 확인

## 7.3 경계값
1. `page=0` 접속 시 1페이지로 보정되는지 확인
2. `size=0` 또는 음수 입력 시 기본값(10) 적용 확인
3. 데이터가 아주 적을 때(총건수 < size) 페이지 버튼이 과도하게 뜨지 않는지 확인

## 7.4 오류 복원력
1. DB 연결 실패 또는 쿼리 오류 시 화면이 에러만 던지고 멈추지 않고 빈 목록 처리되는지 확인

---

## 8. 운영/유지보수 포인트

1. `size`값이 너무 크면 성능 저하 가능, 현재 최대 100으로 제한
2. 총 개수가 커지면 카운트 쿼리 부담이 있으므로, 필요 시 캐싱 또는 캐시 정책 고려
3. DB 컬럼명(`PROFILE`)은 환경마다 다를 수 있으므로, 배포 직전 실제 DDL과 맞는지 검증
4. SQL 파라미터 바인딩은 MyBatis가 처리하므로 SQL Injection 위험이 낮음

---

## 9. 비전공자 요약

- 이번 변경은 “한 번에 전체를 다 보여주느라 버퍼가 비대해지던 방식”을  
  “한 페이지당 딱 10개씩 보여주는 방식”으로 바꾼 것이다.
- 관리자 페이지가 커지면 체감되는 속도 저하를 줄이고, 화면 클릭/조회가 더 빠르게 동작한다.
- 동시에 상세보기, 승인 같은 기존 기능은 유지되며, 오류 메시지(예: DB 컬럼 문제) 대응도 반영됐다.

